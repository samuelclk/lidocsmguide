# Sedge

**Sedge** is a one-click setup tool for PoS network/chain validators and nodes. It takes care of the entire on-premise full node setup based on the chosen client, using generated docker-compose scripts based on the desired configuration.

## Full Node Setup <a href="#lido-csm-testnet-workflow" id="lido-csm-testnet-workflow"></a>

{% hint style="info" %}
To use Stereum your machine must be running Ubuntu. You can follow the official installation guide [here](https://ubuntu.com/tutorials/install-ubuntu-desktop).
{% endhint %}

### Video Guide

{% embed url="https://youtu.be/wTxhkr_eDa4?si=1vHZfSK5QMipt31O" %}

### Install Sedge

Go to the [Sedge docs](https://docs.sedge.nethermind.io/) to get and run the installation commands. Run this first command:

```sh
bash <(curl -fsSL https://github.com/NethermindEth/sedge/raw/main/scripts/install.sh)
```

Now you need to make sure that all dependencies are installed, you can use the following to check and install them:

```sh
# Check dependencies
sedge deps check

# Install dependencies
sedge deps install
```

Now we'll see how to set up your node using the interactive and non-interactive methods of Sedge.

### Set up your node with Sedge's interactive mode

The fully interactive mode will guide you through the process covering all steps needed from the setup. It will generate a `docker-compose.yml` and `.env` according to the selection.

```sh
sedge cli
```

**Follow along the prompts in the terminal UI (TUI) to:**

1. Choose `lido-node` >> `Mainnet` or `Hoodi` as the network. Select `full-node` , then accept the default generation path (or change it to your liking).
2. The container tag will be appended to the docker containers running under sedge. You can put something like `lido-setup` or leave it empty. Then click **yes** when asked to set up a validator, accept the default **Mev-Boost** image.
3. Select the **Execution**, **Consensus** and **Validator** clients of your liking. Sedge gives you the option to randomize the choices as well.
4. Validator grace period `1`, for the **Graffiti** you can use `lidoiscool` or anything else. Use the default option for the **Checkpoint Sync** and `No` to **expose all ports**. `Create` for **JWT Source** and `yes` to enabling the monitoring stack.

**Generate & Import Validator Keys**

1. <mark style="color:red;">**\[Testnet only]**</mark> In the following steps you will create validator keys to participate in Lido CSM:
   * `create` the keystore source.
   * `create` the mnemonic source. Back up the seed phrase to recover the keys in case you loose them, or generate more keys in the future.
   * `create` the passphrase for the keys.
   * Specify how many validator keys you want to generate, and put `0` as the initial index for keystores.
   * Verify the fee recipient and withdrawal address on the [CSM Operator Portal](https://operatorportal.lido.fi/modules/community-staking-module)
2. <mark style="color:green;">**\[Mainnet]  WIP**</mark>

{% tabs %}
{% tab title="Withdrawal Address" %}
* **Mainnet:** [`0xB9D7934878B5FB9610B3fE8A5e441e8fad7E293f`](https://etherscan.io/address/0xb9d7934878b5fb9610b3fe8a5e441e8fad7e293f)&#x20;
* **Hoodi:**  [`0x4473dCDDbf77679A643BdB654dbd86D67F8d32f2`](https://hoodi.etherscan.io/address/0x4473dCDDbf77679A643BdB654dbd86D67F8d32f2)
{% endtab %}

{% tab title="Fee Recipient Address" %}
* **Mainnet:** [`0x388C818CA8B9251b393131C08a736A67ccB19297`](https://etherscan.io/address/0x388C818CA8B9251b393131C08a736A67ccB19297)
* **Hoodi:** [`0x9b108015fe433F173696Af3Aa0CF7CDb3E104258`](https://hoodi.etherscan.io/address/0x9b108015fe433F173696Af3Aa0CF7CDb3E104258)
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
It is highly recommended to use a [secure key generation workflow](../../generating-validator-keys/key-generation-for-mainnet/) in a later section for Mainnet
{% endhint %}

Sometimes while starting the setup, the validator import container exits with an error. If that happens try running `sedge run`.&#x20;

It will pull the rest of the images (execution, consensus, mev-boost, etc), you'll have to wait a few seconds for the `sedge-validator-blocker` to finish waiting for the Consensus client to succesfully sync with the checkpoint. This is a security measure built into Sedge.&#x20;

### Upload deposit data

Copy the deposit data generated by the command below for uploading onto the Lido CSM Widget.

* **Mainnet:** [https://csm.lido.fi/](https://csm.lido.fi/)
* **Hoodi:** [https://csm.testnet.fi/](https://csm.testnet.fi/)

```
cat ~/sedge-data/keystore/deposit_data.json
```

Example:

{% hint style="success" %}
\[{"pubkey": "b72e61268081e28b583d78876cc1687d72be4c3592de1f9d585c96b4c64b25b49174f04ae6e55eb1e59247cb575c0157", "withdrawal\_credentials": "010000000000000000000000f0179dec45a37423ead4fad5fcb136197872ead9", "amount": 32000000000, "signature": "8bb6e8838d15ea0ea23ed5151436ea07b65a0530ccfa9f5154b1fa394827df5add81510cf3463b79a387b0dffbe43ae417ea53b844b43d6a249fbc153fa1deda9fc089f218a845e382aa7455d804650e0e03232d3dad36b180bbdacd908f286c", "deposit\_message\_root": "8dbda15641eb7be3573f7377d10634c93c2b1dceb9fb6e519ec54ae0286d04c7", "deposit\_data\_root": "43f215ce19df49591db322bd4966667afc2a226a0a9812e5d60e31c60223991c", "fork\_version": "01017000", "network\_name": "holesky", "deposit\_cli\_version": "2.7.0"}]
{% endhint %}

Look at the page below to set up and manage your operator in the Lido CSM Widget.

{% content-ref url="../../lido-csm-widget/" %}
[lido-csm-widget](../../lido-csm-widget/)
{% endcontent-ref %}

### Monitor your setup

**View logs:**

Monitor the logs of your validator node to make sure that it is syncing (or synced) with no errors while you wait for Lido to provision your validator deposit with 32 ETH.

Using `sedge logs` will show logs for all services. To view logs of each docker container run:

```
sedge logs <service> --tail 20
```

**Flags:**

* `--tail`: Print the last N lines of the logs.

Choose one to replace the `<container_name>` above.

```
execution        mev-boost
consensus        validator
```

**Check the Node Operator status:**

Sedge has a built-in command to fetch information from your operator.

```
sedge lido-status <reward-address>
```

**Flags:**

* `--network`: Sepcify the network where your Node operator is at.
* `--NodeID <operator-number>`: use the ID of your operator instead of reward address.

This helps you monitor your Node Operator's performance by displaying:

* Node Operator ID
* Queue information (e.g., available for deposit, stuck, refunded, exited, deposited)
* Bond and rewards details

**Grafana Dashboards & Lido Monitoring:**

You can monitor your node and CSM operator with Sedge. Note that you **need to have your Node Operator set up** through the Lido CSM Widget to get your Node Operator number.

```
sedge monitoring init lido --node-operator-id <operator-number> --network <mainnet or hoodi>
```

**Flags:**

* `--network`: Specify the network where your Node Operator is at.
* `--node-operator-id`: ID of your operator, alternatively you can use `--reward-address` and it will use the reward address to identify the operator.

This will install and configure monitoring services, including Grafana, Prometheus,  Node Exportar and Lido Exporter.

You will find dashboards specifically designed for Lido CSM with key panels:

* **Keys and Bonds Information**: Displays data about validator keys (deposited, exit requests, etc.) and bond statuses (current bond, required bond, etc.).
* **Rewards:** non-claimed rewards for your node operator.
* **Penalties**: Tracks penalties related to slashing, EL rewards stealing, and withdrawal issues.
* **Exit Requests**: Monitors exit requests for your validators.

To access your Grafana dashboard, navigate to `INTERNAL_IP:3000` on your web browser.

***

You can read more about Nethermind Sedge in their [official documentation](https://docs.sedge.nethermind.io/).
